{% extends "layouts/base.html" %}

{% block content %}
<div class="min-h-screen bg-background">
    <header class="bg-card border-b border-border">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-headline font-bold">{{ session.title }}</h1>
                    <p class="text-sm text-muted-foreground">Welcome, {{ student.name }}!</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-muted-foreground">Your Score</div>
                    <div class="text-3xl font-bold text-primary">{{ student.score }}</div>
                </div>
            </div>
        </div>
    </header>
    
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto">
            <div class="mb-6 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Translate the Phrases</h2>
                <a href="/session/{{ session.pin }}/leaderboard" class="text-primary hover:underline flex items-center">
                    <i data-lucide="trophy" class="w-4 h-4 mr-1"></i>
                    Leaderboard
                </a>
            </div>
            
            <div class="space-y-4">
                {% for phrase in phrases %}
                <div class="rounded-lg border border-border bg-card p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-sm text-muted-foreground">Phrase #{{ phrase.order }}</p>
                            <h3 class="text-2xl font-semibold">{{ phrase.text }}</h3>
                        </div>
                        <span class="px-2 py-1 rounded text-xs bg-primary/10 text-primary">{{ phrase.language|upper }}</span>
                    </div>
                    
                    <form hx-post="/session/{{ session.pin }}/submit" hx-target="#result-{{ phrase.id }}" hx-swap="innerHTML">
                        <input type="hidden" name="phrase_id" value="{{ phrase.id }}">
                        <input type="hidden" name="student_id" value="{{ student.id }}">
                        <div class="flex space-x-2">
                            <input type="text" name="answer" required placeholder="Type your answer..."
                                class="flex h-10 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm" />
                            <button type="submit" class="bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-6 rounded-md">
                                Submit
                            </button>
                        </div>
                        <div id="result-{{ phrase.id }}" class="mt-2"></div>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</div>

<script>
document.body.addEventListener('htmx:afterOnLoad', function(event) {
    const response = JSON.parse(event.detail.xhr.response);
    if (response.is_correct) {
        event.detail.target.innerHTML = `
            <div class="bg-green-100 border border-green-300 text-green-800 px-4 py-2 rounded-md text-sm">
                ✓ Correct! +${response.points} points
            </div>
        `;
        setTimeout(() => location.reload(), 1500);
    } else {
        event.detail.target.innerHTML = `
            <div class="bg-red-100 border border-red-300 text-red-800 px-4 py-2 rounded-md text-sm">
                ✗ Incorrect. Try again!
            </div>
        `;
    }
});
</script>
{% endblock %}
